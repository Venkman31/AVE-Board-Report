<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVE KPI Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Added D3.js library for charts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Define the brand colors from the logo */
            --ave-teal: #009688; /* A shade of teal from the logo */
            --ave-orange: #f59e0b; /* Tailwind's amber-500, close to the logo's orange */
            --ave-dark: #374151; /* Tailwind's gray-700, for text */
        }
        .bg-ave-teal { background-color: var(--ave-teal); }
        .text-ave-teal { color: var(--ave-teal); }
        .bg-ave-orange { background-color: var(--ave-orange); }
        .text-ave-orange { color: var(--ave-orange); }
        .text-ave-dark { color: var(--ave-dark); }
        .border-ave-teal { border-color: var(--ave-teal); }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <!-- This div now holds a single page -->
    <div class="max-w-4xl mx-auto">

        <!-- ============================================= -->
        <!--                  PAGE 1                       -->
        <!-- ============================================= -->
        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg flex flex-col space-y-6">
            <!-- Page Header -->
            <div class="flex justify-between items-center border-b pb-4 border-gray-200">
                <div>
                    <!-- Recreating the logo text style -->
                    <h1 class="text-4xl font-bold tracking-tight">
                        <span class="text-ave-teal">A</span><span class="text-ave-orange">V</span><span class="text-ave-teal">E</span>
                    </h1>
                    <p class="text-xs font-medium text-gray-500 tracking-wider">ADDED VALUE ENTERPRISES</p>
                </div>
                <div class="text-right">
                    <h2 class="text-xl font-bold text-ave-dark">KPI Summary Report</h2>
                    <p class="text-sm text-gray-500">YTD Performance</p>
                </div>
            </div>

            <!-- Commercial KPIs -->
            <div>
                <h3 class="text-xl font-semibold text-ave-teal mb-3">Commercial KPIs</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Revenue -->
                    <div class="bg-gray-50 rounded-lg p-4 text-center">
                        <p class="text-sm text-gray-500">Revenue vs Budget (YTD)</p>
                        <p class="text-3xl font-bold text-ave-orange">+£5k</p>
                        <p class="text-sm text-gray-700">Actual: £199k</p>
                    </div>
                    <!-- PBIT -->
                    <div class="bg-ave-teal text-white rounded-lg p-4 text-center">
                        <p class="text-sm opacity-90">PBIT vs Budget (YTD)</p>
                        <p class="text-3xl font-bold">+£8.4k</p>
                        <p class="text-sm opacity-90">Actual: £35.8k</p>
                    </div>
                    <!-- Conversion Rate Donut Chart -->
                    <div class="bg-gray-50 rounded-lg p-4 flex flex-col items-center justify-center">
                        <p class="text-sm text-gray-500 text-center mb-2">New Business Conversion (YTD)</p>
                        <div id="conversion-chart"></div>
                    </div>
                </div>

                <h4 class="text-lg font-semibold text-ave-teal mb-2 mt-6">In-Month Performance</h4>
                <!-- In-Month Table -->
                <div class="overflow-x-auto rounded-lg border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-ave-teal">
                            <tr>
                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-white uppercase tracking-wider">
                                    KPI
                                </th>
                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-white uppercase tracking-wider">
                                    Variance
                                </th>
                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-white uppercase tracking-wider">
                                    Actual
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-sm">
                            <tr>
                                <td class="px-4 py-2 whitespace-nowrap text-ave-orange font-medium">Revenue vs Budget</td>
                                <td class="px-4 py-2 whitespace-nowrap text-gray-700">+£5k</td>
                                <td class="px-4 py-2 whitespace-nowrap text-gray-700">£199k</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 whitespace-nowrap text-ave-orange font-medium">PBIT vs Budget</td>
                                <td class="px-4 py-2 whitespace-nowrap text-gray-700">+£8.4k</td>
                                <td class="px-4 py-2 whitespace-nowrap text-gray-700">£35.8k</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 whitespace-nowrap text-ave-orange font-medium">New Business Conversion</td>
                                <td class="px-4 py-2 whitespace-nowrap text-gray-700">20%</td>
                                <td class="px-4 py-2 whitespace-nowrap text-gray-500">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Operational & People KPIs (Moved from Page 2) -->
            <div class="pt-6 border-t border-gray-200 mt-6">
                <h3 class="text-xl font-semibold text-ave-teal mb-4">Operational & People KPIs</h3>
                
                <!-- Operational KPIs -->
                <div>
                    <h4 class="text-lg font-semibold text-ave-teal mb-3">Operational KPIs (YTD)</h4>
                    <!-- Replaced gray boxes with teal boxes -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-ave-teal text-white rounded-lg p-4 flex flex-col items-center justify-center">
                            <p class="text-sm opacity-90 text-center mb-2">Ticket Success KPI</p>
                            <div id="ticket-success-chart"></div>
                        </div>
                        <div class="bg-ave-teal text-white rounded-lg p-4 flex flex-col items-center justify-center">
                            <p class="text-sm opacity-90 text-center mb-2">Total Tickets (KPI)</p>
                            <div id="total-tickets-chart"></div>
                        </div>
                        <div class="bg-ave-teal text-white rounded-lg p-4 flex flex-col items-center justify-center">
                            <p class="text-sm opacity-90 text-center mb-2">Nutrition Menu Turnaround</p>
                            <div id="nutrition-chart"></div>
                        </div>
                    </div>
                </div>

                <!-- People KPI -->
                <div class="pt-4 border-t border-gray-200 mt-6">
                    <h4 class="text-lg font-semibold text-ave-teal mb-2">People KPI</h4>
                     <div class="bg-ave-teal text-white rounded-lg p-4 text-center">
                        <p class="text-sm opacity-90">Mandatory Training Completion (YTD)</p>
                        <p class="text-3xl font-bold text-ave-orange">8</p>
                        <p class="text-sm opacity-90">4 completed in-month</p>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <script>
        // D3.js script for Conversion Rate Donut Chart
        (function() {
            /**
             * Creates a donut chart in a specified D3 selector.
             * @param {string} selector - The D3 selector (e.g., "#chart-id")
             * @param {number} data - The percentage value (0-100)
             * @param {string} arcColor - The hex code for the arc
             * @param {string} [textColor='#374151'] - The hex code for the text
             * @param {number} [fontSize=22] - Optional font size
             * @param {string} [remainingColor='#e5e7eb'] - Optional hex code for the remaining part of the arc
             */
            function createDonutChart(selector, data, arcColor, textColor = '#374151', fontSize = 22, remainingColor = '#e5e7eb') {
                const width = 100;
                const height = 100;
                const radius = Math.min(width, height) / 2;
                // const remainingColor = '#e5e7eb'; // gray-200 // This is now an argument

                const pieData = [
                    { value: data },
                    { value: 100 - data }
                ];

                const svg = d3.select(selector)
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g")
                    .attr("transform", `translate(${width / 2}, ${height / 2})`);

                const color = d3.scaleOrdinal()
                    .domain([0, 1])
                    .range([arcColor, remainingColor]);

                const pie = d3.pie()
                    .value(d => d.value)
                    .sort(null);

                const arc = d3.arc()
                    .innerRadius(radius - 15) // Creates the donut hole
                    .outerRadius(radius);

                svg.selectAll("path")
                    .data(pie(pieData))
                    .enter()
                    .append("path")
                    .attr("d", arc)
                    .attr("fill", (d, i) => color(i));

                // Add text label in the middle
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("dy", ".35em") // Vertically centers
                    .style("font-size", `${fontSize}px`)
                    .style("font-weight", "bold")
                    .attr("fill", textColor)
                    // Format to 1 decimal place if it's a float, 0 if integer
                    .text(`${parseFloat(data.toFixed(1))}%`); 
            }

            // --- Create all charts ---
            
            // New Business Conversion (YTD)
            createDonutChart("#conversion-chart", 21, '#f59e0b'); // ave-orange

            // --- Operational KPIs (Teal boxes) ---
            const tealRemainingColor = 'rgba(255, 255, 255, 0.3)'; // Semi-transparent white for teal background
            const whiteColor = '#FFFFFF';

            // Ticket Success KPI (Orange arc, white text, on teal bg)
            createDonutChart("#ticket-success-chart", 56, '#f59e0b', whiteColor, 22, tealRemainingColor);

            // Total Tickets (KPI) (Orange arc, white text, on teal bg)
            createDonutChart("#total-tickets-chart", 62, '#f59e0b', whiteColor, 22, tealRemainingColor);

            // Nutrition Bespoke Menu Turnaround (Orange arc, white text, on teal bg)
            createDonutChart("#nutrition-chart", 92.50, '#f59e0b', whiteColor, 19, tealRemainingColor);

        })();
    </script>

</body>
</html>
